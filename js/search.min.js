function build(e,n){var i=n?fadeDur:0;current.engine=e,e=eng[e],$(".title").html(titlePrefix+e.pageTitle),$(".method").stop().queue("fx",[]).animate({opacity:0},i),op=idxState?idxFadedOpacity:0,$(".engines a").stop().queue("fx",[]).removeClass("active"),$("#"+current.engine+"_logo").addClass("active").animate({opacity:1},fadeDur),$(".engines a:not(.active)").animate({opacity:op},fadeDur),"object"==typeof e.languages?setLang(firstProp(e.languages)):$(".lang").fadeOut(fadeDur),closeSugBox(!1),$(".i").attr("autosave","com.infinise.go."+current.engine),$(".input input").focus(),setTimeout(function(){$(".method").html("");for(place in e.places)$(".method").append("<a onclick='setPlace(this)'>"+place+"</a>");setPlace(".method a:first"),$(".method").animate({opacity:1},fadeDur)},i)}function nextPlace(){var e=findNext(eng[current.engine].places,current.place);$(".method a").each(function(){$(this).html()==e&&setPlace($(this))})}function nextLanguage(){setLang(findNext(eng[current.engine].languages,current.language))}function setPlace(e){current.place=$(e).html(),$(".method a").removeClass("active"),$(e).addClass("active"),$(".input input").focus(),eng[current.engine].places[current.place][1]!==!1?(fetchSuggestions(),$(".i").attr("autocomplete","off")):(closeSugBox(!1),$(".i").attr("autocomplete","on"))}function setLang(e){current.language=e,$(".lang").fadeIn(fadeDur).html(e),$(".input input").focus()}function doSearch(){var e=eng[current.engine].places[current.place][0];return e=e.replace("%query%",encodeURIComponent($(".i").val())),"object"==typeof eng[current.engine].languages&&(e=e.replace("%lang%",eng[current.engine].languages[current.language])),window.location.href=e,!1}function indexCreate(){var n=0,i=0,t=0,a=0,s=Math.floor(idxWidth/idxLogoSmall[0]);for(e in eng)0==a&&numKeys(eng)-t<=numKeys(eng)%s&&(a=s-numKeys(eng)%s,a=a*(idxLogoSmall[0]+idxMargin)/2),$(".engines").prepend("<a id='"+e+"_logo' ref='"+e+"'><img src='img/engines/"+eng[e].logo+"'></a>"),i==s&&(i=0,n++),eng[e].idxPos=[(idxLogoSmall[0]+idxMargin)*i-idxWidth/2+a,(idxLogoSmall[1]+idxMargin)*n],i++,t++;idxHeight=(n+1)*(idxLogoSmall[1]+idxMargin)-idxMargin,idxHeight=Math.max(idxHeight,idxLogoFull[1]),$(".engines a").click(function(){build($(this).attr("ref"),!0)}),$(".engines a").css({left:"50%",bottom:"0",marginLeft:-idxLogoFull[0]/2+"px"}),$(".engines").mouseenter(function(){indexOpen()}),$(".engines").mouseleave(function(){indexClose()})}function indexOpen(){idxState=!0,clearTimeout(idxClear),$(".engines").css({height:idxHeight});for(e in eng){var n=$("#"+e+"_logo").hasClass("active");$("#"+e+"_logo").stop().queue("fx",[]).animate({marginLeft:eng[e].idxPos[0]+"px",marginBottom:eng[e].idxPos[1]+"px",opacity:n?1:idxFadedOpacity,width:idxLogoSmall[0],height:idxLogoSmall[1]},fadeDur)}}function indexClose(){idxState=!1,$(".engines").css({height:idxLogoFull[1]}),$(".engines a").each(function(){var e=$(this).hasClass("active");$(this).stop().queue("fx",[]).animate({marginLeft:-idxLogoFull[0]/2+"px",marginBottom:0,opacity:e?1:0,width:idxLogoFull[0],height:idxLogoFull[1]},fadeDur)}),idxClear=setTimeout(function(){$(".engines a:not(.active)").css("opacity",0)},fadeDur)}function nextEngine(){build(findNext(eng,current.engine),!0)}function fetchSuggestions(e){if(void 0==e||!inArray(e,new Array(13,16,20,27,37,38,39,40))&&!isCtrl&&!isCmd)if(""!=$(".i").val()&&eng[current.engine].places[current.place][1]!==!1){current.suggestionsTimestamp=(new Date).getTime();var n=eng[current.engine].places[current.place][1];n=n.replace("%query%",encodeURIComponent($(".i").val())),n=n.replace("%time%",current.suggestionsTimestamp),"object"==typeof eng[current.engine].languages&&(n=n.replace("%lang%",eng[current.engine].languages[current.language])),$.getJSON(n,function(e){buildSuggestions(e)})}else closeSugBox(!1)}function buildSuggestions(e){if(e.empty)console&&console.log("(1) Suggestions for '"+e.query+"' empty."),closeSugBox(!1);else if(e.engine==current.engine&&e.timestamp==current.suggestionsTimestamp&&e.query==$(".i").val()){console&&console.log("(2) Suggestions for '"+e.query+"' accepted."),$(".sugs").html("");for(sug in e.results)sug=e.results[sug],$(".sugs").append("<li><a href='"+sug[1]+"'>"+sug[0]+"</a></li>");$(".sugs").css({display:"block"}),$(".sugs li").mousemove(function(){$(".sugs .active").removeClass("active"),$(this).addClass("active")}).click(function(){applySugResult()})}else console&&console.log("(3) Suggestions for '"+e.query+"' discarded.")}function prevSugResult(){"none"!=$(".sugs").css("display")&&(0==$(".sugs .active").length?$(".sugs li:last-child").addClass("active"):$(".sugs .active").removeClass("active").prev().addClass("active"),backupQuery())}function nextSugResult(){"none"!=$(".sugs").css("display")&&(0==$(".sugs .active").length?$(".sugs li:first-child").addClass("active"):$(".sugs .active").removeClass("active").next().addClass("active"),backupQuery())}function backupQuery(){$(".sugs .active").length>0?(originalQuery||(originalQuery=$(".i").val()),$(".i").val($(".sugs .active a").html())):($(".i").val(originalQuery),originalQuery=!1)}function closeSugBox(e){(0==e||void 0==e||"i"!=e.id&&"sugs"!=e.id)&&$(".sugs").html("").css({display:"none"})}function applySugResult(){$(".sugs .active").length>0&&($(".i").val($(".sugs .active a").html()),closeSugBox(!1))}var idxState=!1,idxClear=void 0,originalQuery=!1;